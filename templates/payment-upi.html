{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UPI Payment - RCShop</title>
<link rel="stylesheet" href="{% static 'css/payment-upi.css' %}">
</head>
<body>

<h2 class="title">Complete Your Payment</h2>

<div class="main-box">

  <div class="qr-wrapper">
    <img src="data:image/png;base64,{{ qr_code }}" class="qr-img" width="260">
    <div class="upi-id">UPI ID: <b>{{ upi_id }}</b></div>

    <div class="amount-box">
      ₹{{ amount }}
      <small>Pay exactly this amount</small>
    </div>

    <!-- AUTO OPEN ALL UPI APPS -->
    <a id="upiIntentBtn" class="upi-btn">
      Pay via PhonePe / Google Pay / Paytm
    </a>
  </div>

  <div class="timer">
    Checking payment in <span id="countdown">05:00</span>
  </div>

  <div class="instructions">
    <p>✔ Click above button or scan QR</p>
    <p>✔ Complete payment in your UPI App</p>
    <p>✔ This page will auto-detect payment success</p>
  </div>

  <div id="processing" style="display:none;text-align:center;margin-top:12px;">
    <div class="loader"></div>
    <div style="margin-top:6px;">Verifying your payment securely...</div>
  </div>

</div>

<script>
const upiURL = "{{ upi_url }}";
document.getElementById("upiIntentBtn").href = upiURL;

// AUTO VERIFY LOOP
setInterval(()=>{
  fetch("/upi-verify/?order_id={{ order_id }}")
    .then(r=>r.text())
    .then(res=>{
      if(res === "PAID"){
        window.location.href = "/thankyou/?order_id={{ order_id }}";
      }
    });
}, 3000);
</script>

</body>
</html>
